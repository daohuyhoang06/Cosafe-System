<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EWG Skin Deep</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
  </head>
<body>
  <header class="header">
    <div class="logo">
      <a href="home-page.html" class="logo-link">EWG Skin Deep</a>
    </div>
  </header>  

  <div class="main-content">
    <form action="searching-result.html" method="GET" class="search-container fade-in">
      <input type="text" name="query" placeholder="Search for a product" class="search-bar">
    </form>  

    <div class="hazard-header fade-in delay-1">
      <div class="hazard-title"></div>
      <div class="hazard-links">
        <a id="scoreLink" href="how-we-determine-scores.html">HOW WE DETERMINE SCORES</a>
        <span class="divider">|</span>
        <a id="verifiedLink" href="learn-more-ewg-verified.html">LEARN MORE ABOUT EWG VERIFIED®</a>
      </div>
    </div>


    <div class="hazard-container">
      <img src="assets/images/hazard-score-range.png" alt="Hazard Score Range" class="hazard-img fade-in delay-2" />
      <button class="activate-btn fade-in delay-3" id="activateBtn">Activate Cosafe</button>
    </div>    

    <div class="ewg-products">
      <div class="fade-in delay-4">
        <p>HERE ARE THE PRODUCTS MATCHING YOUR SEARCH:</p>
      </div>
      <div class="product-grid"></div> 
    </div>
    
  </div>

  <div class="pagination">
    <button id="prevPage" disabled>Previous</button>
    <span id="pageInfo"></span>
    <button id="nextPage">Next</button>
  </div>  

  <div class="background-image"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('query');
    if (query) {
      document.querySelector('.search-bar').value = query;
    }

    const scoreLink = document.getElementById('scoreLink');
    const verifiedLink = document.getElementById('verifiedLink');

    scoreLink.href = `how-we-determine-scores.html?query=${encodeURIComponent(query)}`;
    verifiedLink.href = `learn-more-ewg-verified.html?query=${encodeURIComponent(query)}`;

  </script>

  <script>
    const button = document.getElementById("activateBtn");
    window.isCosafeActive = localStorage.getItem("isCosafeActive") === "true"
    button.textContent = window.isCosafeActive ? "Deactivate Cosafe" : "Activate Cosafe";

    button.addEventListener("click", function () {
      window.isCosafeActive = !window.isCosafeActive;
      localStorage.setItem("isCosafeActive", window.isCosafeActive);
      this.textContent = window.isCosafeActive ? "Deactivate Cosafe" : "Activate Cosafe";
      renderProducts(currentPage);
    });
  </script>

  <script>
    //TO DO: Dữ liệu giả lập sản phẩm
    const products = [
      { img: "assets/images/product1.jpg", brand: "ADORABLE BABY", title: "Adorable Baby Natural Baby Lotion" },
      { img: "assets/images/product2.jpg", brand: "Common Heir", title: "Common Heir 10% Vitamin C Serum" },
      { img: "assets/images/product3.jpg", brand: "Better & Better", title: "Better & Better Fully Charged Toothpaste, Bettermint" },
      { img: "assets/images/product4.jpg", brand: "Follain", title: "Follain Eye Cream Firm + Brighten" },
      { img: "assets/images/product5.jpg", brand: "Just the Goods", title: "Just the Goods moisturizing & exfoliating vegan face wash for oily/combination skin" },
    ];

    const itemsPerPage = 3; 
    let currentPage = 1;
    const totalPages = Math.ceil(products.length / itemsPerPage);

    const productGrid = document.querySelector('.product-grid');
    const prevBtn = document.getElementById('prevPage');
    const nextBtn = document.getElementById('nextPage');
    const pageInfo = document.getElementById('pageInfo');

    function renderProducts(page) {
      productGrid.innerHTML = ''; 

      const start = (page - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const paginatedItems = products.slice(start, end);

      paginatedItems.forEach((prod, index) => {
        const delayClass = `delay-${0 + index}`; 

        const card = document.createElement('div');
        card.classList.add('product-card', 'fade-in', delayClass);
        
        card.innerHTML = `
          <img src="${prod.img}" alt="${prod.title}">
          <div class="brand">${prod.brand}</div>
          <div class="title">${prod.title}</div>
        `;

        card.addEventListener("click", () => {
          const encodedTitle = encodeURIComponent(prod.title);

          //TO DO: Truyền thông tin sản phẩm qua URL để chuyển đến trang chi tiết sản phẩm. Query là thông tin trên thanh tìm kiếm.
          window.location.href = `product-detail.html?query=${query}&title=${encodedTitle}`;
        });

        
        productGrid.appendChild(card);
      });

      if (window.isCosafeActive) {
        document.querySelectorAll('.title').forEach(el => {
        //TO DO: tô màu cho tên của mỗi sản phẩm
        
        el.classList.remove('green-highlight', 'yellow-highlight', 'red-highlight');
        // if (Điều kiện để tô màu xanh) {
        //   el.classList.add('green-highlight');
        // } else if (Điều kiện để tô màu vàng) {
             el.classList.add('yellow-highlight');
        // } else if (Điều kiện để tô màu đỏ) {
        //   el.classList.add('red-highlight');
        // }
      });
      }

      pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage === totalPages;
    }

    prevBtn.addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderProducts(currentPage);
      }
    });

    nextBtn.addEventListener('click', () => {
      if (currentPage < totalPages) {
        currentPage++;
        renderProducts(currentPage);
      }
    });

    renderProducts(currentPage);
  </script>


  
</body>
</html>
